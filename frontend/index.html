<h1>Unclassified Permits</h1>

<button onclick="prev_page()">&#60; &#60; </button>
page <span id="pagecount">1</span>
<button onclick="next_page()"> &#62; &#62;</button>

<div id="permits">

</div>

<script>
	function next_page() {
		page++
		document.getElementById("pagecount").innerHTML = page+1;
		clear_permits()
		get_list()
	}
	function prev_page() {
		if (page <= 0) {
			return;
		}
		page--;
		document.getElementById("pagecount").innerHTML = page+1;
		clear_permits()
		get_list()
	}
	var page = 0;
	var permits_per_page = 10;

	function clear_permits(){
		let div = document.getElementById("permits")
		div.innerHTML = ""
	}

	async function get_list() {

		let query =
`
query MyQuery {
  allPermits(
    first: ${permits_per_page}
	offset: ${page}
    orderBy: COST_DESC
    filter: {isConstruction: {isNull: true}}
  ) {
    edges {
      node {
        id
        cost
        city
        sqft
        state
        street
        streetNumber
        sourceBySourceId {
          name
        }
      }
    }
  }
}
`
		var response = await fetch("/graphql", {
			method: 'post',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify({ 'query': query, "operationName": "MyQuery" })
		});
		var data = await response.json();
		console.log(data);
		data.data.allPermits.edges.forEach(permit => {
			let div = document.getElementById("permits")
			let p = document.createElement("code")
			p.innerText = JSON.stringify(permit.node)
			div.appendChild(p)
			console.log(permit.node)
		})
	}

	get_list();


</script>